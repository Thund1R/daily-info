# Update

## 2022-10-03

**新增微信接口测试号、电子邮件通道。**

- 带图文详情页面的接口测试号只支持云服务器或腾讯云函数平台部署

- 电子邮件、不带图文详情页面的接口测试号支持任意平台部署

- 测试号不支持自定义颜色

- 电子邮件不需要配置页面


**调整环境变量随机图片类型 pictype 支持多类型，**同样以&&分隔，例如：dongman&&fengjing。每一次获取随机图片时将从填写的类型中随机选择一种并获取。

**调整企业微信通道下，图文详情页链接长度自动截断为1000字，**以避免内容过长导致发送错误。链接超过1000字的部分内容会被自动去掉并添加省略号，**请合理安排有关多城市、多日期等内容**。

**修复因“ ' ”、“ & ”等字符编码错误导致图文详情页面显示错误的Bug。**

**拆分index.py中的代码。**原index.py代码冗长，测试与修改难度颇高，因此根据功能定位拆分index.py代码。

## 2022-09-16

新增多城市疫情数据，接口来源夸克，在此感谢

新增环境变量 **yqcity**，用于存放疫情数据的城市名字，**只能是市级**，多城市以&&分隔，例如：成都&&南京

新增环境变量 **tian**，用于存放天行数据APIKEY。**申请彩虹屁接口后**，填写tian即获取彩虹屁

修改自定义第一段内容函数逻辑，允许自定义内容与接口内容共存

修改穿衣指数获取方式，修复因非大陆地区可能没有穿衣指数而导致无法显示当地天气的Bug

修改头图逻辑，不填写title、pictype参数时默认使用必应壁纸数据，填写title、pictype任意一个即触发使用随机图片

增加头部注释、指定编码，避免部分平台运行时编码报错的情况

当前支持内容众多，容易突破图文链接长度上限，**请合理安排有关多城市、多日期等内容**

## 2022-09-03

去除项目说明，造成困扰向大家致歉

新增通过天行API获取彩虹屁作为第一段的模板，请自行注册天行https://www.tianapi.com/ 并开通彩虹屁接口，启用时请注释或删除掉上方已经启用的get_my_content

优化config.py注释形式，避免填写时误解上下指示关系

增加各种错误情况下的提示，方便错误时自行排查

## 2022-09-02

新增5处环境变量支持标题、称呼、第一段内容、头图及其类型自定义

随机头图会在手动填写/接口动态获取标题/第一段内容情况下触发

头图类型pictype填写none即单图文模式下不显示头图

修改和风天气填写格式为省/市-市/区/县，更符合习惯

切换开源协议为GPLv3

## 2022-08-30

图文详情页回归，采用腾讯云函数API网关和自行搭建的方式实现

修改安装依赖的方式和指令

增加link环境变量用于填写详情页网址

修复因缺少number参数导致和风天气检索不到城市的bug

修复时区设置失败导致时间错误的bug，统一获取北京时间方式

发布金山文档版完整部署图文教程

## 2022-08-28

得知新建应用要求配置IP的情况，紧急修改部署图文。

酷安发布完整版部署图文，完善教程

增加函数模板供用户自行探索拓展

## 2022-08-27

Vercel.app被ban，图文展示页暂不能访问，等官方修复

修改天气预报地址环境变量city格式为市-市/区/县，以防部分地区重名

## 2022-08-26

加回多图文方案，通过环境变量msgtype选择

删除环境变量TZ，改为代码内实现确定时区

重新上线 ONE·一个 图文功能，单图文模式下只显示文字内容，多图文模式下显示图文

日期提醒全部支持农历/公历，统一自动排序保证提醒有效性

## 2022-08-25

放弃原有多图文方案，采用单图文展示所有信息，更加直观方便

新增随机颜文字、自动更换天气emoji、正向日期计算

暂时下线 ONE·一个 图文功能